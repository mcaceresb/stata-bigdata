
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="How to work efficiently with large datasets (in Stata); BPLIM December 2022 Presentation for the Workshop on Empirical Research with Large Datasets">
      
      
      
        <link rel="canonical" href="https://mcaceresb.github.io/stata-bigdata/break.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>What can break? - Stata and Big Data</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cc9b2e1e.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CInconsolata:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Open Sans";--md-code-font:"Inconsolata"}</style>
      
    
    
      <link rel="stylesheet" href="css/extra-material.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="blue-grey">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-can-break-with-big-data" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Stata and Big Data" class="md-header__button md-logo" aria-label="Stata and Big Data" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Stata and Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              What can break?
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/mcaceresb/stata-bigdata" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mcaceresb/stata-bigdata
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Stata and Big Data" class="md-nav__button md-logo" aria-label="Stata and Big Data" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Stata and Big Data
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/mcaceresb/stata-bigdata" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    mcaceresb/stata-bigdata
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          What can break?
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="break.html" class="md-nav__link md-nav__link--active">
        What can break?
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#generating-ids" class="md-nav__link">
    Generating IDs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerical-precision" class="md-nav__link">
    Numerical Precision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-note-on-long-long-integers-64-bit-8-bytes" class="md-nav__link">
    A note on long long integers (64-bit, 8-bytes)
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Memory Management
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Memory Management" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Memory Management
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="memory/minimize.html" class="md-nav__link">
        Minimize Memory Use
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="memory/swapping.html" class="md-nav__link">
        Caution! Swapping
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Efficient Code
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Efficient Code" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Efficient Code
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="efficient/trade-off.html" class="md-nav__link">
        Trade-Off
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="efficient/plan-ahead.html" class="md-nav__link">
        Planning Ahead
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="efficient/other-resources.html" class="md-nav__link">
        Other Resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="efficient/gtools.html" class="md-nav__link">
        Gtools
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" type="checkbox" id="__nav_4_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_5">
          Better Algorithms
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Better Algorithms" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          Better Algorithms
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="efficient/algorithms/introduction.html" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="efficient/algorithms/merge.html" class="md-nav__link">
        Merge
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="efficient/algorithms/bootstrap.html" class="md-nav__link">
        Bootstrap
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="efficient/right-tool.html" class="md-nav__link">
        The Right Tool
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="tips.html" class="md-nav__link">
        Tips and Tricks/Summary
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#generating-ids" class="md-nav__link">
    Generating IDs
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#numerical-precision" class="md-nav__link">
    Numerical Precision
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-note-on-long-long-integers-64-bit-8-bytes" class="md-nav__link">
    A note on long long integers (64-bit, 8-bytes)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/mcaceresb/stata-bigdata/blob/main/docs/break.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="what-can-break-with-big-data">What can break with big data?</h1>
<h3 id="generating-ids">Generating IDs</h3>
<p>Consider a relatively common operation: Generating a unique identifier for each row of your data. Nothing too complicated:</p>
<div class="highlight"><pre><span></span><code>.<span class="k"> clear</span>
.<span class="k"> qui set</span> obs <span class="nv">`=2^24+5&#39;</span>
.<span class="k"> gen</span> id = _n
.<span class="k"> format</span> <span class="nx">%21.0gc</span> id
.<span class="k"> list in</span> <span class="o">-</span><span class="m">10</span><span class="o">/</span>l

          <span class="o">+------------+</span>
          |         id |
          |<span class="o">------------</span>|
<span class="m">16777212</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">212</span> |
<span class="m">16777213</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">213</span> |
<span class="m">16777214</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">214</span> |
<span class="m">16777215</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">215</span> |
<span class="m">16777216</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">216</span> |
          |<span class="o">------------</span>|
<span class="m">16777217</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">216</span> |
<span class="m">16777218</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">218</span> |
<span class="m">16777219</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">220</span> |
<span class="m">16777220</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">220</span> |
<span class="m">16777221</span>. | <span class="m">16</span>,<span class="m">777</span>,<span class="m">220</span> |
          <span class="o">+------------+</span>

.<span class="k"> disp</span> <span class="s">&quot;</span><span class="nv">`:type id&#39;</span><span class="s">&quot;</span>
float
</code></pre></div>
<p>What went wrong?</p>
<ul>
<li>Stata's default type is <code>float</code>, a 4-byte floating point number.</li>
<li>The largest integer it can accurately represent is 2<sup>24</sup></li>
<li>If we force it to represent larger integers, the variable overflows and we get repeated nubmers, as we can see.</li>
</ul>
<p>What can we do?</p>
<ul>
<li>You can can set the default type to <code>double</code>, an 8-byte floating point number which can represent integers up to 2<sup>53</sup>. Downside is increased memory use.</li>
<li>The efficient solution is to use the <code>c(obs_t)</code> macro:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">gen</span> <span class="nv">`c(obs_t)&#39;</span> id = _n
</code></pre></div>
<p>This uses the smallest <em>integer</em> type that can store the number of observations correctly. In general for any variable bounded above by the number of observations, this is a memory-efficient and safe solution (counts, IDs, etc.) Here you can see it in action:</p>
<div class="highlight"><pre><span></span><code><span class="k">clear</span>
<span class="k">qui set</span> obs <span class="m">1</span><span class="k"></span>
<span class="k">disp</span> <span class="s">&quot;</span><span class="nv">`c(obs_t)&#39;</span><span class="s">&quot;</span> <span class="c1">// byte</span>
<span class="k">qui set</span> obs <span class="nv">`=maxbyte()+1&#39;</span><span class="k"></span>
<span class="k">disp</span> <span class="s">&quot;</span><span class="nv">`c(obs_t)&#39;</span><span class="s">&quot;</span> <span class="c1">// int</span>
<span class="k">qui set</span> obs <span class="nv">`=maxint()+1&#39;</span><span class="k"></span>
<span class="k">disp</span> <span class="s">&quot;</span><span class="nv">`c(obs_t)&#39;</span><span class="s">&quot;</span> <span class="c1">// long</span>
<span class="k">qui set</span> obs <span class="nv">`=maxlong()+1&#39;</span><span class="k"></span>
<span class="k">disp</span> <span class="s">&quot;</span><span class="nv">`c(obs_t)&#39;</span><span class="s">&quot;</span> <span class="c1">// double</span>
</code></pre></div>
<h3 id="numerical-precision">Numerical Precision</h3>
<p>This is a general issue when working with floating point numbers (i.e. real numbers, which are uncountably infinite, represented by finite data). However, big data can compound this problem. Large sums, for instance, can give incorrect results by some margin:</p>
<div class="highlight"><pre><span></span><code>.<span class="k"> clear</span>
.<span class="k"> set</span> obs <span class="m">1000000</span>
.<span class="k"> gen</span> double x    =<span class="k"> sum</span>(_n<span class="o">^</span><span class="m">2</span>)
.<span class="k"> gen</span> double xsum = _n <span class="o">*</span> (_n <span class="o">+</span> <span class="m">1</span>) <span class="o">*</span> (<span class="m">2</span> <span class="o">*</span> _n <span class="o">+</span> <span class="m">1</span>) <span class="o">/</span> <span class="m">6</span>
.<span class="k"> gen</span> double xdif = x <span class="o">-</span> xsum
.<span class="k"> sum</span> xdif,<span class="k"> d</span>

                            xdif
<span class="o">-------------------------------------------------------------</span>
      Percentiles      Smallest
 <span class="m">1</span>%      <span class="o">-</span><span class="m">481312</span>        <span class="o">-</span><span class="m">490752</span>
 <span class="m">5</span>%      <span class="o">-</span><span class="m">443808</span>        <span class="o">-</span><span class="m">490752</span>
<span class="m">10</span>%      <span class="o">-</span><span class="m">396928</span>        <span class="o">-</span><span class="m">490752</span>       Obs           <span class="m">1</span>,<span class="m">000</span>,<span class="m">000</span>
<span class="m">25</span>%      <span class="o">-</span><span class="m">256400</span>        <span class="o">-</span><span class="m">490720</span>       Sum of Wgt.   <span class="m">1</span>,<span class="m">000</span>,<span class="m">000</span>

<span class="m">50</span>%      <span class="o">-</span><span class="m">123600</span>                      Mean          <span class="o">-</span><span class="m">154691.7</span>
                        Largest       Std. Dev.      <span class="m">151885.8</span>
<span class="m">75</span>%            <span class="m">0</span>             .<span class="m">5</span>
<span class="m">90</span>%            <span class="m">0</span>             .<span class="m">5</span>       Variance       <span class="m">2.31e+10</span>
<span class="m">95</span>%            <span class="m">0</span>             .<span class="m">5</span>       Skewness      <span class="o">-</span>.<span class="m">5467313</span>
<span class="m">99</span>%            <span class="m">0</span>             .<span class="m">5</span>       Kurtosis       <span class="m">2.055727</span>
</code></pre></div>
<p>You can see that for half the observations, the sum is off by more than 10<sup>6</sup>. If course, in relative terms this difference is negligible:</p>
<div class="highlight"><pre><span></span><code>.<span class="k"> gen</span> double xrel = <span class="nf">reldif</span>(x, xsum)
.<span class="k"> sum</span> xrel,<span class="k"> d</span>

                            xrel
<span class="o">-------------------------------------------------------------</span>
      Percentiles      Smallest
 <span class="m">1</span>%            <span class="m">0</span>              <span class="m">0</span>
 <span class="m">5</span>%            <span class="m">0</span>              <span class="m">0</span>
<span class="m">10</span>%            <span class="m">0</span>              <span class="m">0</span>       Obs           <span class="m">1</span>,<span class="m">000</span>,<span class="m">000</span>
<span class="m">25</span>%            <span class="m">0</span>              <span class="m">0</span>       Sum of Wgt.   <span class="m">1</span>,<span class="m">000</span>,<span class="m">000</span>

<span class="m">50</span>%     <span class="m">1.63e-12</span>                      Mean           <span class="m">1.51e-12</span>
                        Largest       Std. Dev.      <span class="m">1.20e-12</span>
<span class="m">75</span>%     <span class="m">2.42e-12</span>       <span class="m">3.80e-12</span>
<span class="m">90</span>%     <span class="m">3.29e-12</span>       <span class="m">3.80e-12</span>       Variance       <span class="m">1.43e-24</span>
<span class="m">95</span>%     <span class="m">3.63e-12</span>       <span class="m">3.80e-12</span>       Skewness       .<span class="m">1221362</span>
<span class="m">99</span>%     <span class="m">3.78e-12</span>       <span class="m">3.80e-12</span>       Kurtosis       <span class="m">1.956908</span>
</code></pre></div>
<p>This example merely underlines that care is required when working with large sums. (As a side-note, Stata's internal sums are often quadruple precision, meaning 16-byte floating point number, to avoid these types of issues.)</p>
<h3 id="a-note-on-long-long-integers-64-bit-8-bytes">A note on long long integers (64-bit, 8-bytes)</h3>
<p>Stata's largest integer type is long, 4 bytes as noted above. Sometimes, however, programs will use long long integers, which are 8 bytes. The longest integer represented by a double is 2<sup>53</sup>, but a long long integer can go up to 2<sup>63</sup>-1.</p>
<p>Working around this limitation within Stata is <em>possible</em> since the addition of the Python interface (there's an interesting <a href="https://www.statalist.org/forums/forum/general-stata-discussion/general/1669326-missing-data-type-64-bit-integer-variable">statalist thread about this <img src="https://upload.wikimedia.org/wikipedia/commons/6/64/Icon_External_Link.png" width="13px"/></a> where I pointed out such a solution). However, I will also say that sometimes Stata's not the best tool for the job, and stretching it to its limits is risky. I think it's only advisable to do so if using  other software is prohibitive for some reason.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="index.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="memory/minimize.html" class="md-footer__link md-footer__link--next" aria-label="Next: Minimize Memory Use" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Minimize Memory Use
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.a6c66575.min.js"></script>
      
        <script src="javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>